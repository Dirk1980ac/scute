2008-08-23  Marcus Brinkmann  <marcus@g10code.com>

	* src/Makefile.am [HAVE_W32_SYSTEM]: Build autonomous DLL.
	* src/dllmain.c (DllMain): New file.
	* src/cert-gpgsm.c: Include "debug.h".  Use
	 assuan_pipe_connect_ext instead of assuan_pipe_connect everywhere.
	* src/agent.c (WINVER) [HAVE_W32_SYSTEM]: Define symbol.
	[HAVE_W32_SYSTEM]: Include <windows.h>.  Do this before including
	<assuan.h>.
	(gnupg_allow_set_foregound_window): New function.
	(agent_connect): Use Sleep() instead of _sleep().
	(default_inq_cb): New function, and use it in all transactions.
	(agent_configure): Don't bail out if ttytname is not defined.  Set
	allow-pinentry-notify.
	* tests/t-support.h [_WIN32]: Include <windows.h>.
	(init_cryptoki) [_WIN32]: Call WSAStartup.

2008-08-21  Marcus Brinkmann  <marcus@g10code.com>

	* src/scute.def: Start at @1 instead of @0.

2008-08-21  Marcus Brinkmann  <marcus@g10code.com>

	* src/agent.c (agent_configure): Fix cut and paste error.

2008-08-11  Marcus Brinkmann  <marcus@g10code.com>

	* src/agent.c (spawn_process_detachted) [! HAVE_W32_SYSTEM]: Remove.
	(agent_configure): Ignore error with old versions of gpg-agent.	

2008-08-08  Marcus Brinkmann  <marcus@g10code.de>

	* configure.ac: Update svn macros.
	(BUILD_REVISION, BUILD_FILEVERSION, BUILD_TIMESTAMP): New.
	(AC_CONFIG_OUTPUT): Add src/versioninfo.rc.
	(GPG_AGENT_DEFAULT, GPG_AGENT): New.
	(AC_REPLACE_FUNCS): Add vasprintf and stpcpy.
	(AC_CHECK_FUNCS): Add ttyname, localtime_r and timegm.
	* src/stpcpy.h, src/stpcpy.c, src/realloc.c: New file from gnulib.
	* src/vasprintf.c: New file from libiberty.
	* src/support.h [!HAVE_STPCPY]: Include "stpcpy.h".
	[!HAVE_TTYNAME]: Define simple replacement function.
	(get_gpgsm_path, get_gpg_agent_path)
	(default_homedir, make_filename): New prototypes.
	* src/Makefile.am: Add W32 support.
	(libscute_la_SOURCES): Add get-path.c.
	(EXTRA_DIST): Add versioninfo.rc.in.
	* src/versioninfo.rc.in: New file.
	* src/get-path.c: New file.
	* src/agent.c (PATHSEP_C): New macro.
	(build_w32_commandline_copy)
	(build_w32_commandline) [HAVE_W32_SYSTEM]: New functions.
	(spawn_process_deatched): New function.
	(agent_connect): Start gpg-agent if it is not running yet.
	(agent_configure): Also pass xauthority and pinentry-user-data.
	* src/cert-gpgsm.c (COMPAT_FALLBACK) [!HAVE_W32_SYSTEM]: New
	macro.
	(export_cert_compat) [!COMPAT_FALLBACK]: Remove.
	(export_cert) [!COMPAT_FALLBACK]: Don't call export_cert_compat.
	Don't create (unused) output pipe cruft.
	* src/cert-object.c (time_to_ck_date) [!HAVE_LOCALTIME_R]: Fall
	back to localtime.
	* tests/t-getslotinfo.c (main) [WIN32]: Call _sleep instead sleep.

	* src/cryptoki.h (CRYPTOKI_EXPORTS): Define symbol.
	* src/error-mapping.h: Do not include <error.h>.
	(scute_sys_to_ck): Change type of ERR to int.
	* src/error-mapping.c: Do not include <error.h>.
	(scute_sys_to_ck): Change type of ERR to int.
	* src/slots.c (slot_create_session): Change type of ERR to int.

2007-05-03  Marcus Brinkmann  <marcus@g10code.de>

	Released version 1.1.0.

	* doc/manual/Makefile.am (images_pdf, CLEANFILES): New variables.
	(scute.dvi, scute.pdf): New dependencies.
	(%.eps, %.pdf): New rules.
	* configure.ac: Check for convert and epstopdf.

	* doc/manual/scute.texi (Authentication With Service): Avoid
	@indicateurl in TeX output, as this seems to be broken (in
	texi2dvi 1.34).

	* doc/manual/Makefile.am (images, EXTRA_DIST): New variables.

2007-04-30  Marcus Brinkmann  <marcus@g10code.de>

	* src/agent.h (scute_agent_is_trusted): New prototype.  Include
	<stdbool.h>.
	* src/agent.c (scute_agent_is_trusted): New implementation.
	* src/cert.h (struct cert): New member IS_TRUSTED.
	* src/cert-gpgsm.c (export_cert): Set CERT->is_trusted.
	* src/cert-object.c (scute_attr_cert): Set CKA_TRUSTED to
	CERT->is_trusted.
	* tests/t-getattribute.c: Support new option '--printable'.

	* src/table.c (scute_table_dealloc): Return, but not a value.

2007-02-09  Marcus Brinkmann  <marcus@g10code.de>

	* src/pkcs11.h: Add definitions for SHA.

2006-12-17  Marcus Brinkmann  <marcus@g10code.de>

	* src/pkcs11.h: Minor cosmetic changes.  Require CRYPTOKI_GNU now
	to switch on the GNU API, and do not check what CRYPTOKI_COMPAT is
	defined to, just if it is defined at all.

	* src/pkcs11.h [__WIN32]: Changed to [_WIN32 ||
	CRYPTOKI_FORCE_WIN32] at the end.
	Submitted by Alon Bar-Lev.

2006-12-11  Marcus Brinkmann  <marcus@g10code.de>

	* src/pkcs11.h (CKO_VENDOR_DEFINED): Fixed syntax error.

2006-12-10  Marcus Brinkmann  <marcus@g10code.de>

	* configure.ac (NEED_GPG_ERROR_VERSION): Bump to 1.4.

	* src/pkcs11.h [CRYPTOKI_COMPAT]: Rewrote the compatibility layer.

2006-12-09  Marcus Brinkmann  <marcus@g10code.de>

	* src/pkcs11.h [__cplusplus]: Protect with extern "C".
	Do not use the C++ keyword "template" in parameter lists.
	Submitted by Alon Bar-Lev.

	* src/pkcs11.h [__WIN32]: Changed to [_WIN32 ||
	CRYPTOKI_FORCE_WIN32].
	(ck_rv_t): Changed to unsigned long.
	(CRYPTOKI_VERSION_MAJOR, CRYPTOKI_VERSION_MINOR,
	CRYPTOKI_VERSION_REVISION): New macros.
	(CKO_VENDOR_DEFINED, CKH_VENDOR_DEFINED, CKK_VENDOR_DEFINED,
	CKC_VENDOR_DEFINED, CKA_VENDOR_DEFINED, CKM_VENDOR_DEFINED,
	CKF_EXTENSION, CKR_VENDOR_DEFINED): Add cast to suppress compiler
	warning.
	Submitted by Alon Bar-Lev.

	* src/cryptoki.h (CRYPTOKI_VERSION_MAJOR, CRYPTOKI_VERSION_MINOR):
	Removed.

2006-11-30  Marcus Brinkmann  <marcus@g10code.de>

	* m4/autobuild.m4: New file.
	* configure.ac: Invoke AB_INIT.

2006-11-29  Marcus Brinkmann  <marcus@g10code.de>

	* configure.ac (CFLAGS): Remove variable.

2006-11-27  Marcus Brinkmann  <marcus@g10code.de>

	* src/pkcs11.h: Add more definitions provided by Andreas Jellinghaus.

	* README (Copyright and License): Update copyright notice.  Also
	for all other files.
	* AUTHORS (Maintainer): Removed RSA Security Inc.
	* include/pkcs11t.h, include/pkcs11f.h, include/pkcs11.h,
	include/disclaimer.txt, include/cryptoki-w32.h,
	include/cryptoki-generic.h, include/README, include/Makefile.am:
	Files removed.
	* configure.ac (AC_CONFIG_FILES): Removed include/Makefile.
	* Makefile.am (SUBDIRS): Removed include directory.

2006-11-24  Marcus Brinkmann  <marcus@g10code.de>

	* src/pkcs11.h: New file.
	* src/Makefile.am (libscute_la_SOURCES): Add pkcs11.h.
	* src/cryptoki.h: Include "pkcs11.h" instead of original PKCS #11
	header file.
	* tests/t-support.h (mechanism_type_str): Remove most mechanisms.

2006-11-23  Marcus Brinkmann  <marcus@g10code.de>

	* src/cert-gpgsm.c (search_certs_line): Don't overwrite CERT->uid.

2006-11-21  Marcus Brinkmann  <marcus@g10code.de>

	* src/cert-gpgsm.c (search_certs_line): Fix off-by-one error.
	(export_cert_cb): Fix bug if EXP->buffer_size is 0.

	* src/cert-gpgsm.c (cert_reset): Free CERT->cert_der if set.
	(export_cert): Reimplement using data channel.
	(export_cert_compat): This contains the old version for
	compatibility.
	* src/cert.h (MAX_CERT_SIZE): Macro removed.
	(struct cert): Changed member CERT_DER into a pointer.

	* configure.ac (AC_CONFIG_FILES): Add doc/manual/Makefile.
	* doc/Makefile.am (SUBDIRS): New variable.
	* doc/manual/Makefile, doc/manual/scute.texi, doc/manual/gpl.texi,
	doc/manual/mdate-sh, doc/manual/texinfo.tex,
	doc/manual/firefox-cm.png, doc/manual/firefox-cm-view-detail.png,
	doc/manual/firefox-cm-view.png,
	doc/manual/firefox-dm-load-after.png,
	doc/manual/firefox-dm-load-before.png,
	doc/manual/firefox-dm-load.png,
	doc/manual/firefox-dm-token-present.png,
	doc/manual/firefox-pref.png, doc/manual/firefox-pref-view.png: New
	files.

2006-11-11  Marcus Brinkmann  <marcus@g10code.de>

	* Released version 1.0.0.

2006-11-11  Marcus Brinkmann  <marcus@g10code.de>

	* src/error-mapping.c (scute_gpg_err_to_ck): Report error on debug
	stream.
	* src/slots.c (add_object): New function.
	(slot_init): Rewritten using add_object.
	* src/gpgsm.c: Include "gpgsm.h".
	(struct search): Replace members ATTRP, ATTR_COUNTP, PRV_ATTRP,
	PRV_ATTR_COUNTP by CERT_GET_CB, HOOK.
	(search_cb): Rewritten to add all certificates for a certain key
	(scute_gpgsm_get_cert): Take a callback function instead of
	attribute pointers.
	* gpgsm.h (scute_gpgsm_get_cert): Adjust prototype.	
	and also the certificate chain.
	* src/cert.h (scute_gpgsm_search_certs_by_fpr): New prototype.
	(struct cert): New member chain_id.
	* src/cert-gpgsm.c (struct search_ctx_by_grip): Rename to ...
	(struct search_ctx): ... this.  Rename field GRIP to PATTERN, and
	add new field FIELD.
	(search_certs_by_grip): Rename function to ...
	(search_certs): ... this.
	(scute_gpgsm_search_certs_by_fpr): Change user of the above.
	(scute_gpgsm_search_certs_by_fpr): New function.
	(search_certs_line): Store chain ID.

2006-11-07  Marcus Brinkmann  <marcus@g10code.de>

	* src/p11-gettokeninfo.c (C_GetTokenInfo): Fix assignment.

2006-11-06  Marcus Brinkmann  <marcus@g10code.de>

	* doc/website/format/web.css: Set margin to 0.

	* configure.ac (AC_CONFIG_FILES): Add doc/Makefile.
	Makefile.am (SUBDIRS): Add doc/.
	doc/, doc/website/, doc/website/format: New directories.
	doc/Makefile.am, doc/website/index.xhtml,
	doc/website/documentation.xhtml, doc/website/download.xhtml,
	doc/website/contact.xhtml, doc/website/format/web.css,
	doc/website/format/scute-logo.svg,
	doc/website/format/scute-border.jpg: New files.

2006-10-30  Marcus Brinkmann  <marcus@g10code.de>

	* configure.ac (PACKAGE, VERSION): Define these variables.
	* src/Makefile.am (libscute_la_CPPFLAGS): Fix include path for
	VPATH builds.

	* configure.ac (VERSION_MAJOR, VERSION_MINOR): New variable
	definitions.
	* src/gpgsm.h: Fix syntax error.
	* src/table.c, src/table.h: Rewritten.
	* src/slots.c: Reorganized and rewritten to use the new table
	interface.  Include gpgsm.h.
	* src/p11-signinit.c, src/p11-sign.c, src/p11-getslotlist.c,
	src/p11-getsessioninfo.c, src/p11-getmechanismlist.c,
	src/p11-getattributevalue.c, src/p11-findobjectsinit.c,
	src/p11-findobjectsfinal.c, src/p11-findobjects.c,
	src/p11-closesession.c: Adjust callers.

2006-10-26  Marcus Brinkmann  <marcus@g10code.de>

	* src/settings.h: Require VERSION_MAJOR and VERSION_MINOR to be
	defined.

	* src/p11-getinfo.c (CRYPTOKI_VERSION_MAJOR,
	CRYPTOKI_VERSION_MINOR): Move macros to ...
	* src/cryptoki.h (CRYPTOKI_VERSION_MAJOR, CRYPTOKI_VERSION_MINOR):
	... here

	* src/gpgsm.c (gpgsm_get_cert): Rename to ...
	(scute_gpgsm_get_cert): ... this.
	* src/gpgsm.h: New file.
	* src/Makefile.am (libscute_la_SOURCES): Add gpgsm.h.
	* src/slots.c (gpgsm_get_cert): Remove prototype.
	(slots_update_slot): Call scute_gpgsm_get_cert, not gpgsm_get_cert.

	* src/error-mapping.c (scute_gpg_err_to_ck): Map GPG_ERR_NO_AGENT
	to CKR_GENERAL_ERROR.
	* src/agent.h (struct agent_card_info_s): Remove member error.
	Prefix external functions with scute_ if not already done so, also
	for callers.
	* src/agent.c: Include <stdarg.h>.  Replace one-letter variable
	names by proper ones.  Replace assuan_error_t with gpg_error_t
	everywhere.
	(agent_connect, agent_simple_cmd, agent_configure): New functions.
	(scute_agent_initialize): Use these new functions.
	ing of common code.  Lots of cleanups.
	(scute_agent_finalize): Clear agent_ctx.  Add debug message.

2006-10-13  Werner Koch  <wk@g10code.com>

	* src/cert-gpgsm.c (MAX_LINE_LEN): Increased.

	* src/locking.c: Include string.h for memset declaration.

	* configure.ac: New option --disable-optimization.

2006-08-02  Marcus Brinkmann  <marcus@g10code.de>

	* Initial version.


 Copyright 2006, 2007, 2008 g10 Code GmbH

 This file is free software; as a special exception the author gives
 unlimited permission to copy and/or distribute it, with or without
 modifications, as long as this notice is preserved.

 This file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY, to the extent permitted by law; without even the
 implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
