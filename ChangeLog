2006-11-21  Marcus Brinkmann  <marcus@g10code.de>

	* src/cert-gpgsm.c (search_certs_line): Fix off-by-one error.
	(export_cert_cb): Fix bug if EXP->buffer_size is 0.

	* src/cert-gpgsm.c (cert_reset): Free CERT->cert_der if set.
	(export_cert): Reimplement using data channel.
	(export_cert_compat): This contains the old version for
	compatibility.
	* src/cert.h (MAX_CERT_SIZE): Macro removed.
	(struct cert): Changed member CERT_DER into a pointer.

	* configure.ac (AC_CONFIG_FILES): Add doc/manual/Makefile.
	* doc/Makefile.am (SUBDIRS): New variable.
	* doc/manual/Makefile, doc/manual/scute.texi, doc/manual/gpl.texi,
	doc/manual/mdate-sh, doc/manual/texinfo.tex,
	doc/manual/firefox-cm.png, doc/manual/firefox-cm-view-detail.png,
	doc/manual/firefox-cm-view.png,
	doc/manual/firefox-dm-load-after.png,
	doc/manual/firefox-dm-load-before.png,
	doc/manual/firefox-dm-load.png,
	doc/manual/firefox-dm-token-present.png,
	doc/manual/firefox-pref.png, doc/manual/firefox-pref-view.png: New
	files.

2006-11-11  Marcus Brinkmann  <marcus@g10code.de>

	* Released version 1.0.0.

2006-11-11  Marcus Brinkmann  <marcus@g10code.de>

	* src/error-mapping.c (scute_gpg_err_to_ck): Report error on debug
	stream.
	* src/slots.c (add_object): New function.
	(slot_init): Rewritten using add_object.
	* src/gpgsm.c: Include "gpgsm.h".
	(struct search): Replace members ATTRP, ATTR_COUNTP, PRV_ATTRP,
	PRV_ATTR_COUNTP by CERT_GET_CB, HOOK.
	(search_cb): Rewritten to add all certificates for a certain key
	(scute_gpgsm_get_cert): Take a callback function instead of
	attribute pointers.
	* gpgsm.h (scute_gpgsm_get_cert): Adjust prototype.	
	and also the certificate chain.
	* src/cert.h (scute_gpgsm_search_certs_by_fpr): New prototype.
	(struct cert): New member chain_id.
	* src/cert-gpgsm.c (struct search_ctx_by_grip): Rename to ...
	(struct search_ctx): ... this.  Rename field GRIP to PATTERN, and
	add new field FIELD.
	(search_certs_by_grip): Rename function to ...
	(search_certs): ... this.
	(scute_gpgsm_search_certs_by_fpr): Change user of the above.
	(scute_gpgsm_search_certs_by_fpr): New function.
	(search_certs_line): Store chain ID.

2006-11-07  Marcus Brinkmann  <marcus@g10code.de>

	* src/p11-gettokeninfo.c (C_GetTokenInfo): Fix assignment.

2006-11-06  Marcus Brinkmann  <marcus@g10code.de>

	* doc/website/format/web.css: Set margin to 0.

	* configure.ac (AC_CONFIG_FILES): Add doc/Makefile.
	Makefile.am (SUBDIRS): Add doc/.
	doc/, doc/website/, doc/website/format: New directories.
	doc/Makefile.am, doc/website/index.xhtml,
	doc/website/documentation.xhtml, doc/website/download.xhtml,
	doc/website/contact.xhtml, doc/website/format/web.css,
	doc/website/format/scute-logo.svg,
	doc/website/format/scute-border.jpg: New files.

2006-10-30  Marcus Brinkmann  <marcus@g10code.de>

	* configure.ac (PACKAGE, VERSION): Define these variables.
	* src/Makefile.am (libscute_la_CPPFLAGS): Fix include path for
	VPATH builds.

	* configure.ac (VERSION_MAJOR, VERSION_MINOR): New variable
	definitions.
	* src/gpgsm.h: Fix syntax error.
	* src/table.c, src/table.h: Rewritten.
	* src/slots.c: Reorganized and rewritten to use the new table
	interface.  Include gpgsm.h.
	* src/p11-signinit.c, src/p11-sign.c, src/p11-getslotlist.c,
	src/p11-getsessioninfo.c, src/p11-getmechanismlist.c,
	src/p11-getattributevalue.c, src/p11-findobjectsinit.c,
	src/p11-findobjectsfinal.c, src/p11-findobjects.c,
	src/p11-closesession.c: Adjust callers.

2006-10-26  Marcus Brinkmann  <marcus@g10code.de>

	* src/settings.h: Require VERSION_MAJOR and VERSION_MINOR to be
	defined.

	* src/p11-getinfo.c (CRYPTOKI_VERSION_MAJOR,
	CRYPTOKI_VERSION_MINOR): Move macros to ...
	* src/cryptoki.h (CRYPTOKI_VERSION_MAJOR, CRYPTOKI_VERSION_MINOR):
	... here

	* src/gpgsm.c (gpgsm_get_cert): Rename to ...
	(scute_gpgsm_get_cert): ... this.
	* src/gpgsm.h: New file.
	* src/Makefile.am (libscute_la_SOURCES): Add gpgsm.h.
	* src/slots.c (gpgsm_get_cert): Remove prototype.
	(slots_update_slot): Call scute_gpgsm_get_cert, not gpgsm_get_cert.

	* src/error-mapping.c (scute_gpg_err_to_ck): Map GPG_ERR_NO_AGENT
	to CKR_GENERAL_ERROR.
	* src/agent.h (struct agent_card_info_s): Remove member error.
	Prefix external functions with scute_ if not already done so, also
	for callers.
	* src/agent.c: Include <stdarg.h>.  Replace one-letter variable
	names by proper ones.  Replace assuan_error_t with gpg_error_t
	everywhere.
	(agent_connect, agent_simple_cmd, agent_configure): New functions.
	(scute_agent_initialize): Use these new functions.
	ing of common code.  Lots of cleanups.
	(scute_agent_finalize): Clear agent_ctx.  Add debug message.

2006-10-13  Werner Koch  <wk@g10code.com>

	* src/cert-gpgsm.c (MAX_LINE_LEN): Increased.

	* src/locking.c: Include string.h for memset declaration.

	* configure.ac: New option --disable-optimization.

2006-08-02  Marcus Brinkmann  <marcus@g10code.de>

	* Initial version.


 Copyright 2006 g10 Code GmbH

 This file is free software; as a special exception the author gives
 unlimited permission to copy and/or distribute it, with or without
 modifications, as long as this notice is preserved.

 This file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY, to the extent permitted by law; without even the
 implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
